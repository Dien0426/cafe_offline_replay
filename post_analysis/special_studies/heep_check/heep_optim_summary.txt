Used h(e,e'p) cafe run 16962 to determine step-by-step corrections applied.
After each step, a replay of both data/simc is done prior to next iteration
for the changes to take effect



sub-directory structure (step number)

-----> In the directory ./optim_steps

initial/ (step1)
---------------------
-> no angle. / momentum corrections or offsets on either spec. arm
-> data has mispointing + beam_offsets applied automatically
-> simc only has beam_offsets applied

corrections determined
-> from proton momentum difference, Pdiff = Pcalc-Pmeas, a correction
factor of : hms_fcorr =  0.9977 was determined for HMS proton momentum,
Pf_corr = Pf_uncorr * hms_fcorr = 1.820 * 0.9977 = 1.816 
 
-> HMS Ytar also seems a bit off, might be due to mispointing not being


step 2
--------
-> applied HMS momentum correction to both data/simc (0.9977)
-> applied HMS mispointing to SIMC (to fix hms Ytar alignment)
-> applied SHMS out-of-plane central angle offset
(based on Pmy component offset)
p_oopcentral_offset = +0.002711 [rad]

step 3
--------
Found dEmiss ~31 MeV offset in Emiss and dE'=~30 MeV offset in SHMS e- momentum,
and given that final protom momentum correction was determined previously,
implied that the remaining shift in Emiss was entirely due to e- momentum,
NOT beam energy

In addition, the measured shift (from fit) in invariant mass was dW ~ 37 MeV,
From its derivative, dW= -Eb/E’*dE’, and also since we measured dE'~30 MeV,
the expected offset in dW ~ -10.549/8.55 * 30 ~ -37 MeV ! ! ! This is precisely
the observed offset in dW, which means the entire offset in dW was due to E', and not
Ebeam or e- scat angle

-> applied SHMS momentum correction to both data/simc (0.9968)

after step3 corrections,
* data Emiss is still low by ~1 MeV, and W, Pmx, Pmz are not perfectly aligned (W ~ 3 MeV, Pmx ~ 3 MeV, Pmz ~ 1.4 MeV data off from simc)

* approach:

in the next step (step4)
--> lower e- momentum by ~1 MeV to align Emiss, (replay data and check, i.e., step4)

then the following step (step5)
--> find HMS(p)/SHMS(e-) angle offsets that best align W, Pmx, Pmz, this can be achieved via the following equations:

for h(e,e'p) since we know Pmiss x,y,z is zero, then we can write (by simple momentum conservation of e-p scattering)
Pmx = E'*sin(theta_e) - pf*sin(theta_p)         
Pmz = Eb - E'*cos(theta_e) - pf*cos(theta_p)  

taking the full derivatives (2 equations, 2 unkowns -> dtheta_e, dtheta_p):
dPmx = E'*cos(theta_e)*dtheta_e - pf*cos(theta_p)dtheta_p
dPmz = E'*sin(theta_e)*dtheta_e + pf*sin(theta_p)dtheta_p

where dPmx, dPmz --> (Pmx,z_data - Pmx,z_simc) ,   dtheta_e,p --> (theta_e,p_data - theta_e,p_simc)
the correction in angle would then be:  theta_e,p_corrected = theta_e,p_data - dtheta_e,p



step4
-------
Lowering SHMS (e-) momentum by 1 MeV had the following effects:
--> aligned Emiss and Pmz (Pmz is ~ 0.8 MeV off)
--> Pmx and W are still offset by ~ 4 MeV and 2 MeV respectively

** At this point, if we change e- angle to make W line up, the Pmx
will be offset even further, but if we change the proton angle, W
will be left the same, and Pmx will shift,

From the beam energy measurement, we know: 10.549355 +/- 0.0041371  GeV/c
so there is a dE ~ 4 MeV uncertainty in beam energy

*** Suggested next steps:  start the optimization procedure over but with
a higher beam



------------------------------------------------------------------------
START Re-optimization procedure by + 4 MeV on beam energy
------------------------------------------------------------------------

Shift the beam energy by +4 MeV, and start procedure to determine if
we get better agreement between data/simc W, Pmx
(start with the determine out-of-plane offset as well as the HMS mispointings, as these will not affect this alignment)


sub-directory structure (step number)

-----> In the directory ./optim_with_Eb_shift

-------
step1:
-------

-> Beam energy shiftef by +4 MeV (within uncertainty) 10549.355-> 10553.355 GeV
-> no momentum corrections
-> out-of-plane angle offset applied to align Pmy
-> data has mispointing + beam_offsets applied automatically
-> simc has HMS_mispointing + beam_offsets applied

corrections determined (to be applied before next step):
-> from proton momentum difference, Pdiff = Pcalc-Pmeas, a correction
factor of : hms_fcorr =  0.9977 was determined for HMS proton momentum,
Pf_corr = Pf_uncorr * hms_fcorr = 1.820 * 0.9977 = 1.8158 

-------
step2:
-------
-> HMS Momentum correction: 1.820 -> 1815.8 GeV 
-> Em data shifted ~4 MeV closer to simc (~ data is still ~27 MeV lower than simc) 
—> Pcalc-Pmeas difference between data/simc        is now ~ 2e-4 GeV (proton momentum well known) 

In summary:
—> relative to SIMC, the data is offset by: W ~ -34 MeV offset, Em ~ -27 MeV offset, Pmx ~  +19 MeV, Pmz ~ +15 MeV

Given that proton momentum and beam energy have already been shifted, the remaining difference in Emiss is due to E'

From the Emiss derivatives,
dEm = -dE'

Therefore, the corrected e- momentum is:
E'_corr =  E' + dE' = E' (1 + dE'/E') = E' (1 - dEm/E')
Given that dEm = 27.3 MeV and E' = 8550 MeV/c, then the correction factor is :  fcorr = 1 - (27.3/8550.) = 0.9968

-------
step3:
-------
SHMS momentum changed:  8.55 -> 8.5226 GeV/c
—> W is aligned (offset ~1e-4 GeV)
—> Em data is +2.8 MeV too high
—> Pmx data is -6.63 MeV too low —> Pmz data is -1.3 MeV too low  Eb and E’ would have to change such
   As to keep W aligned, and shift Em lower,  and Pmx, Pmz higher

-------
step4:
-------
Using dW derivatives,  it was determined that by lowering Eb by -8 MeV
(at the lower limit of the Eb +/- 4 MeV uncertainty), and by lowering 
Ef by 5 MeV,  would generate equal and opposite offsets in W, but also
would shift Emiss by 2.8 MeV lower to be aligned with SIMC. This seemed
to have  Worked, however,  Pmx, is still not aligned.  
Trying to align Pmx,
--> if proton angle is offset ro align Pmx, it would cause an offset in proton momentum difference (Pcalc-Pmeas)
--> if e- angle is offset to align Pmx, it would offset W significantly
